#a) Make folders ESOM, ESOM/tax, and ESOM/fasta in project folder

    mkdir ESOM
		mkdir ESOM/tax
    mkdir ESOM/fasta

#b) From within ESOM folder, copy edited .fasta file from spades to ESOM folder

    cp ../fastqc/filename_spades_1000contigsremoved.fasta ./

#c) Obtain blastn.pbs, and place in ESOM folder. Modify for appropriate files and location.

    vi blastn.pbs

#d) Load ncbi module
	
    load module ncbi-blast/2.2.29

#e) Submit blastn.pbs to flux, which will process for 2-3 hours.
	
    qsub blastn.pbs

#f) Obtain and copy scripts to ESOM folder
 
    cp /home/uniqueid/scripts/blast_taxonomy_report.pl ./
		cp /home/uniqueid/scripts/gi_taxid_nucl.dmp.gz ./
		cp /home/uniqueid/scripts/names.dmp ./
		cp /home/uniqueid/scripts/nodes.dmp ./
		cp /home/uniqueid/scripts/print_tetramer_freqs_deg_filter_esom_VD.pl ./

#g) Run blast_taxonomy_report.pl in background of PuTTY

    perl -blast [output file of blastn.pbs] -nodes nodes.dmp -names names.dmp -gi_taxid_file gi_taxid_nucl.dmp.gz > filename_blastreport.txt &

#i) Once you have generated blast report, copy to Excel. Add a column to characterize taxa and save Excel sheet. Then delete all but contigs and characterization column and save as tab delimited filename_blastreport_annotation.txt file.

#h) Copy print_tetramer_freqs_deg_filter_esom_VD.pl, original spades .fasta file, and blast report annotation .txt file into the tax folder. Enter folder and generate input files (.cls, .lrn, .names) for ESOM using perl script.

    cp print_tetramer_freqs_deg_filter_esom_VD.pl ./tax/
    cp filename_spades_1000contigsremoved.fasta ./tax/
    cp filename_blastreport_annotation.txt ./tax/
    perl print_tetramer_freqs_deg_filter_esom_VD.pl -s filename_spades_1000contigsremoved.fasta -m 1000 -w 3000 k -4 -a filename_blastreport_annotation.txt

#i) Run ESOM using GitHub instructions.

#j) From ESOM, resulting .cls file will be putative genome/bacterial contaminant/organelle DNA/etc. To extract those contigs from the original fasta file, obtain getClassFasta.pl and run on selected .cls file

    perl /home/chytrids/scripts/getClassFasta.pl -fasta filename_spades_1000contigsremoved.fasta -names filename_spades_1000contigsremoved.fasta.names -num 1 -loyal 75 -cls filename_put_genome.cls

#k) Results in .fasta and .conf files, which will need renaming, e.g. filename_put_genome. Copy into fasta folder.

  cp filename_put_genome.fasta ../fasta/
  cp filename_put_genome.conf ../fasta/

#k-i) If you wish to see GenBank accessions for selected contigs, first save list of contigs from the appropriate .conf file.

    cat filename_put_genome.conf | cut -f2 | grep "NODE" > ../filename_put_genome_contigs.txt

#k-ii) Using original blastn output file, select contigs isolated with ESOM and get list of unique GenBank accessions.

    cat Clado_tenue_ntdb_evalue5 | grep -f Clado_tenue_mito_contigs.txt | cut -f2 | tr "|" "\t" | cut -f4 | sort | uniq > Clado_tenue_mito_contig_gbaccessions.txt
